<ui:composition template="index.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">
        <h:outputText value="#{MESSAGE.MENU_ITEM_PERSONAL_SCHEDULE}"/>
    </ui:define>
    <ui:define name="content">
        <h:form id="scheduleForm">

            <p:growl id="growl" showDetail="true" severity="info,warn,error"/>

            <p:schedule id="schedule" value="#{scheduleDoctorView.eventModel}" locale="ru" view="agendaWeek" firstHour="6"
                        minTime="7am" maxTime="8pm" styleClass="scheduleCalendar" timeZone="GMT+2" widgetVar="schedule"
                        rightHeaderTemplate="agendaDay,agendaWeek"
                        allDaySlot="false" tooltip="false">
                <p:ajax event="eventSelect" listener="#{scheduleDoctorView.onEventSelect}" update="addScheduleDialog"
                        oncomplete="PF('addScheduleDialog').show();"/>
                <p:ajax event="eventMove" listener="#{scheduleDoctorView.onEventMove}" update="growl"
                        oncomplete="PF('schedule').update();"/>
                <p:ajax event="dateSelect" listener="#{scheduleDoctorView.onDateSelect}" update=":planForm:addPlanDialog"
                        oncomplete="PF('addPlanDialog').show();"/>
                <p:ajax event="eventResize" listener="#{scheduleDoctorView.onEventResize}" update="growl"
                        oncomplete="PF('schedule').update();"/>
            </p:schedule>

            <p:dialog
                    header="#{scheduleDoctorView.schedule.id==null?MESSAGE.SCHEDULE_ADD_DIALOG_TITLE:MESSAGE.SCHEDULE_EDIT_DIALOG_TITLE}
			        #{scheduleDoctorView.schedule.doctor.firstName} #{scheduleDoctorView.schedule.doctor.lastName}"
                    widgetVar="addScheduleDialog" id="addScheduleDialog" modal="false" showEffect="clip"
                    styleClass="addScheduleDialog" closeOnEscape="true" width="1000" height="630">

                <p:messages id="errorMessage" showDetail="true" style="width:800px;font-size:90%" escape="true"/>

                <p:wizard flowListener="#{scheduleDoctorView.onFlowProcess}">
                    <p:tab id="personalTab" title="#{MESSAGE.SCHEDULE_TAB_PERSONAL}">
                        <h:panelGrid columns="3" cellpadding="5">

                            <!-- Phone Number Mobile -->
                            <h:outputLabel for="phoneNumberMobile" value="#{MESSAGE.USERS_PHONE_NUMBER_MOBILE}"/>
                            <p:inputMask value="#{scheduleDoctorView.patient.phoneNumberMobile}"
                                         id="phoneNumberMobile" name="phoneNumberMobile"
                                         mask="+38(999)999-99-99" required="true"
                                         requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}"
                                         validator="#{usersValidator.validate}">
                                <f:attribute name="name" value="phoneNumberMobile"/>
                                <p:ajax event="blur" listener="#{scheduleDoctorView.fillUserData}"
                                        update="phoneNumberMobileMessage growl firstName middleName lastName"/>
                            </p:inputMask>
                            <p:message for="phoneNumberMobile" id="phoneNumberMobileMessage"/>

                            <!-- First Name -->
                            <h:outputLabel for="firstName" value="#{MESSAGE.USERS_FIRST_NAME}"/>
                            <p:autoComplete value="#{scheduleDoctorView.patient.firstName}"
                                            id="firstName" name="firstName"
                                            placeholder="#{MESSAGE.USERS_PLACEHOLDER_FIRST_NAME}"
                                            completeMethod="#{scheduleDoctorView.allFirstNames}"
                                            validator="#{usersValidator.validate}" required="true"
                                            requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}">
                                <f:attribute name="name" value="firstName"/>
                                <p:ajax event="blur" update="firstNameMessage growl"
                                        process="firstName"/>
                            </p:autoComplete>
                            <p:message for="firstName" id="firstNameMessage"/>

                            <!-- Last Name -->
                            <h:outputLabel for="lastName" value="#{MESSAGE.USERS_LAST_NAME}"/>
                            <p:autoComplete value="#{scheduleDoctorView.patient.lastName}"
                                            id="lastName" name="lastName"
                                            placeholder="#{MESSAGE.USERS_PLACEHOLDER_LAST_NAME}"
                                            completeMethod="#{scheduleDoctorView.allMiddleNames}"
                                            validator="#{usersValidator.validate}" required="true"
                                            requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}">
                                <f:attribute name="name" value="lastName"/>
                                <p:ajax event="blur" update="lastNameMessage growl"/>
                            </p:autoComplete>
                            <p:message for="lastName" id="lastNameMessage"/>

                            <!-- Middle Name -->
                            <h:outputLabel for="middleName"
                                           value="#{MESSAGE.USERS_MIDDLE_NAME}"/>
                            <p:autoComplete value="#{scheduleDoctorView.patient.middleName}"
                                            id="middleName" name="middleName"
                                            placeholder="#{MESSAGE.USERS_PLACEHOLDER_MIDDLE_NAME}"
                                            completeMethod="#{scheduleDoctorView.allLastNames}"
                                            validator="#{usersValidator.validate}">
                                <f:attribute name="name" value="middleName"/>
                                <p:ajax event="blur" update="middleNameMessage growl"/>
                            </p:autoComplete>
                            <p:message for="middleName" id="middleNameMessage"/>

                            <!-- Description -->
                            <h:outputLabel for="scheduleDescription"
                                           value="#{MESSAGE.ENTITY_DESCRIPTION}"/>
                            <p:inputTextarea rows="7" cols="20" id="scheduleDescription"
                                             value="#{scheduleDoctorView.schedule.description}">
                                <!--p:ajax event="blur" update="planDescriptionMessage" /-->
                            </p:inputTextarea>
                            <p:message for="scheduleDescription" id="scheduleDescriptionMessage"/>
                        </h:panelGrid>

                        <p:fieldset legend="#{MESSAGE.SCHEDULE_TAB_DOCUMENTS}" toggleable="true" toggleSpeed="500">
                            <h:panelGrid columns="1" cellpadding="5">
                                <p:commandButton type="button" value="#{MESSAGE.SCHEDULE_PRINT_FORM}" title="#{MESSAGE.SCHEDULE_PRINT_FORM}"
                                                 actionListener="#{scheduleDoctorView.printForm}" icon="ui-icon-print" update="growl" style="width:300px"/>
                                <p:commandButton type="button" value="#{MESSAGE.SCHEDULE_PRINT_SECURE_AGREEMENT}" title="#{MESSAGE.SCHEDULE_PRINT_SECURE_AGREEMENT}"
                                                 actionListener="#{scheduleDoctorView.printSecureAgreement}" icon="ui-icon-print" update="growl" style="width:300px"/>
                                <p:commandButton type="button" value="#{MESSAGE.SCHEDULE_PRINT_INCOME_FORM}" title="#{MESSAGE.SCHEDULE_PRINT_INCOME_FORM}"
                                                 actionListener="#{scheduleDoctorView.printPrintIncomeForm}" icon="ui-icon-print" update="growl" style="width:300px"/>

                            </h:panelGrid>
                        </p:fieldset>
                    </p:tab>

                    <p:tab id="appointmentTab" title="#{MESSAGE.SCHEDULE_TAB_APPOINTMENT}">
                        <h:panelGrid columns="3" cellpadding="5">

                            <!-- Assistent -->
                            <h:outputLabel for="assistent" value="#{MESSAGE.SCHEDULE_ASSISTENT}"/>
                            <p:selectOneMenu id="assistent" value="#{scheduleDoctorView.schedule.assistant}"
                                             converter="usersConverter"
                                             styleClass="mySelectOneMenu">
                                <f:selectItem itemLabel="#{MESSAGE.SCHEDULE_WITHOUT_ASSISTENT}" itemValue="#{null}"/>
                                <f:selectItems value="#{scheduleDoctorView.allAssistents}" var="assistent"
                                               itemLabel="#{assistent.firstName} #{assistent.lastName}"
                                               itemValue="#{assistent}"/>
                            </p:selectOneMenu>
                            <p:message for="assistent" id="assistentMessage"/>

                            <!-- Partner -->
                            <h:outputLabel for="partner" value="#{MESSAGE.SCHEDULE_PARTNER}"/>
                            <p:selectOneMenu id="partner" value="#{scheduleDoctorView.schedule.doctorDirected}"
                                             converter="usersConverter"
                                             styleClass="mySelectOneMenu">
                                <f:selectItem itemLabel="#{MESSAGE.SCHEDULE_WITHOUT_DOCTOR_DIRECTED}"
                                              itemValue="#{null}"/>
                                <f:selectItems value="#{scheduleDoctorView.allPartners}" var="partner"
                                               itemLabel="#{partner.firstName} #{partner.lastName}"
                                               itemValue="#{partner}"/>
                            </p:selectOneMenu>
                            <p:message for="partner" id="partnerMessage"/>

                            <!-- Start time -->
                            <h:outputLabel for="dateTimeStart" value="#{MESSAGE.SCHEDULE_TIME_START}"/>
                            <p:calendar id="dateTimeStart" value="#{scheduleDoctorView.schedule.dateTimeStart}"
                                        required="true" pattern="dd-MM-yyyy HH:mm"
                                        requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}"
                                        validator="#{scheduleValidator.validate}">
                                <f:attribute name="name" value="dateTimeStart"/>
                                <p:ajax event="blur" update="dateTimeStartMessage growl"/>
                            </p:calendar>
                            <p:message for="dateTimeStart" id="dateTimeStartMessage"/>

                            <!-- Break Slider -->
                            <h:outputLabel for="breakSlider" id="breakSlideroutput"
                                           value="#{MESSAGE.SCHEDULE_BREAK_TIME} #{scheduleDoctorView.breakTime} #{MESSAGE.SCHEDULE_MINUTES}"
                                    />
                            <h:panelGroup>
                                <h:inputHidden id="breakSlider" value="#{scheduleDoctorView.breakTime}" required="true"
                                               requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}"
                                        />
                                <p:slider for="breakSlider" display="breakSlideroutput" step="5" minValue="5"
                                          maxValue="60"
                                          displayTemplate="#{MESSAGE.SCHEDULE_BREAK_TIME} {value} #{MESSAGE.SCHEDULE_MINUTES}"/>
                            </h:panelGroup>
                            <p:message for="breakSlider" id="breakSliderMessage"/>

                            <!--Method Types-->
                            <h:outputLabel for="methodTypes" value="#{MESSAGE.SCHEDULE_METHOD_TYPE}"/>
                            <p:selectOneMenu id="methodTypes" value="#{scheduleDoctorView.selectedMethodType}"
                                             converter="methodTypesConverter"
                                             required="true" requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}"
                                             styleClass="mySelectOneMenu">
                                <f:selectItems value="#{scheduleDoctorView.allMethodTypes}" var="methodType"
                                               itemLabel="#{methodType.shortName}" itemValue="#{methodType}"/>
                                <p:ajax event="change" update="methods" listener="#{scheduleDoctorView.constructPickList}"/>
                            </p:selectOneMenu>
                            <p:message for="methodTypes" id="methodTypesMessage"/>

                            <!-- Methods-->
                            <h:outputLabel for="methods" id="metodsLabel" escape="false"
                                           value="#{MESSAGE.SCHEDULE_METHOD}&lt;br/&gt;
                    #{MESSAGE.SCHEDULE_TOTAL_PRICE}: #{scheduleDoctorView.totalPrice} #{MESSAGE.APPLICATION_CURRENCY}&lt;br\&gt;
                    #{MESSAGE.SCHEDULE_TOTAL_TIME_LENGTH}: #{scheduleDoctorView.totalTime} #{MESSAGE.APPLICATION_MINUTES_SHORT}"/>
                            <p:pickList id="methods" value="#{scheduleDoctorView.methodsDualListModel}" var="method"
                                        effect="bounce"
                                        itemValue="#{method}"
                                        itemLabel="#{method.shortName} #{scheduleDoctorView.pricesFacade.findLastPrice(method).total}"
                                        showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"
                                        styleClass="typePicker"
                                        converter="methodsConverter" required="true"
                                        requiredMessage="#{MESSAGE.SCHEDULE_METHOD}">
                                <f:facet name="sourceCaption"><h:outputText
                                        value="#{MESSAGE.SCHEDULE_METHOD_AVAILABLE}"/></f:facet>
                                <f:facet name="targetCaption"><h:outputText
                                        value="#{MESSAGE.SCHEDULE_METHOD_SELECTED}"/></f:facet>

                                <p:ajax event="transfer" listener="#{scheduleDoctorView.onTransfer}"
                                        update="metodsLabel growl"/>
                            </p:pickList>
                            <p:message for="methods" id="methodsMessage"/>

                            <!--h:outputLabel for="planSaveButton" value="" /-->
                            <p:commandButton id="scheduleSaveButton"
                                             value="#{MESSAGE.SCHEDULE_ADD_BUTTON}"
                                             icon="ui-icon-plus"
                                             actionListener="#{scheduleDoctorView.addSchedule}"
                                             update="errorMessage growl"
                                             oncomplete="PF('schedule').update();"
                                             rendered="#{scheduleDoctorView.schedule.id==null}"
                                             styleClass="myButton"
                                             validateClient=""
                                    />
                            <p:commandButton id="scheduleEditButton"
                                             value="#{MESSAGE.SCHEDULE_EDIT_BUTTON}"
                                             icon="ui-icon-pencil"
                                             actionListener="#{scheduleDoctorView.editSchedule}"
                                             update="errorMessage growl"
                                             oncomplete="PF('schedule').update();"
                                             rendered="#{scheduleDoctorView.schedule.id!=null}"
                                             validateClient="scheduleValidator"
                                             styleClass="myButton"
                                    />
                            <p:commandButton id="scheduleDeleteButton"
                                             value="#{MESSAGE.SCHEDULE_DELETE_BUTTON}"
                                             icon="ui-icon-close"
                                             actionListener="#{scheduleDoctorView.deleteSchedule}"
                                             update="errorMessage growl"
                                             rendered="#{scheduleDoctorView.schedule.id!=null}"
                                             oncomplete="PF('schedule').update(); PF('addScheduleDialog').hide();"
                                             styleClass="myButton">
                                <p:confirm header="#{MESSAGE.SCHEDULE_DELETE_CONFIRM_TITLE}"
                                           message="#{MESSAGE.SCHEDULE_DELETE_CONFIRM_MESSAGE}" icon="ui-icon-alert"/>
                            </p:commandButton>

                        </h:panelGrid>
                    </p:tab>

                </p:wizard>
                <script>

                    $("#method .ui-multiselectlistbox-listcontainer +.ui-multiselectlistbox-listcontainer li").click(
                            function () {
                                alert("hello");
                                $("#updateSelectedMethod").click();
                            }
                    );


                </script>
            </p:dialog>
            <h:outputText value="#{scheduleDoctorView.cssStyle}" escape="false"/>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="explode">
                <p:commandButton value="#{MESSAGE.SCHEDULE_DELETE_CONFIRM_YES}" type="button"
                                 styleClass="ui-confirmdialog-yes" icon="ui-icon-check" process="@none"/>
                <p:commandButton value="#{MESSAGE.SCHEDULE_DELETE_CONFIRM_NO}" type="button"
                                 styleClass="ui-confirmdialog-no" icon="ui-icon-close" process="@none"/>
            </p:confirmDialog>
        </h:form>
        <h:form id="planForm">

            <p:dialog header="#{MESSAGE.PLAN_ADD_DIALOG_TITLE}"
                      widgetVar="addPlanDialog" id="addPlanDialog" modal="false" showEffect="clip"
                      styleClass="addPlanDialog">
                <p:growl id="growl" showDetail="true" severity="info"/>
                <p:messages id="errorMessage" showDetail="true" style="width:400px;font-size:90%" escape="true"/>

                <h:panelGrid columns="2" cellpadding="5">

                    <h:outputLabel for="dateTimeStart" value="#{MESSAGE.PLAN_TIME_START}"/>
                    <p:calendar id="dateTimeStart" value="#{scheduleDoctorView.plan.dateTimeStart}"
                                required="true" pattern="dd-MM-yyyy HH:mm"
                                requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}">
                        <!--f:attribute name="name" value="dateTimeStart" /-->
                        <!-- p:ajax event="blur" update="dateTimeStartMessage" /-->
                    </p:calendar>
                    <!--p:message for="dateTimeStart" id="dateTimeStartMessage" /-->

                    <h:outputLabel for="dateTimeEnd" value="#{MESSAGE.PLAN_TIME_END}"/>
                    <p:calendar id="dateTimeEnd" value="#{scheduleDoctorView.plan.dateTimeEnd}"
                                required="true" pattern="dd-MM-yyyy HH:mm"
                                requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}">
                        <!--f:attribute name="name" value="dateTimeEnd" /-->
                        <!--p:ajax event="blur" update="dateTimeStartMessage" /-->
                    </p:calendar>
                    <!--p:message for="dateTimeEnd" id="dateTimeEndMessage" /-->

                    <h:outputLabel for="planRoom" value="#{MESSAGE.PLAN_ROOM}"/>
                    <p:selectOneMenu id="planRoom" value="#{scheduleDoctorView.plan.room}" converter="roomsConverter"
                                     required="true" requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}"
                                     styleClass="mySelectOneMenu">
                        <!--f:attribute name="name" value="planRoom" /-->
                        <!--f:selectItem itemLabel="#{MESSAGE.PLAN_CHOOSE}" itemValue="#{null}"/-->
                        <f:selectItems value="#{scheduleDoctorView.allRooms}" var="room"
                                       itemLabel="#{room.name}" itemValue="#{room}"/>
                        <!-- p:ajax event="change" update="planRoomMessage" /-->
                    </p:selectOneMenu>
                    <!--p:message for="planRoom" id="planRoomMessage" /-->

                    <h:outputLabel for="planDoctor" value="#{MESSAGE.PLAN_DOCTOR}"/>
                    <p:selectOneMenu id="planDoctor" value="#{scheduleDoctorView.plan.doctor}" converter="usersConverter"
                                     required="true" requiredMessage="#{MESSAGE.VALIDATOR_REQUIRED}"
                                     styleClass="mySelectOneMenu"
                                     validator="#{planValidator.validate}">
                        <!--f:attribute name="name" value="planDoctor" /-->
                        <!--f:selectItem itemLabel="#{MESSAGE.PLAN_CHOOSE}" itemValue="#{null}"/-->
                        <f:selectItems value="#{scheduleDoctorView.allDoctors}" var="doctor"
                                       itemLabel="#{doctor.firstName} #{doctor.lastName}" itemValue="#{doctor}"/>
                        <!-- p:ajax event="change" update="planDoctorMessage" /-->
                    </p:selectOneMenu>
                    <!--p:message for="planDoctor" id="planDoctorMessage" /-->

                    <h:outputLabel for="planDescription"
                                   value="#{MESSAGE.ENTITY_DESCRIPTION}"/>
                    <p:inputTextarea rows="6" cols="20" id="planDescription"
                                     value="#{scheduleDoctorView.plan.description}">
                        <!--p:ajax event="blur" update="planDescriptionMessage" /-->
                    </p:inputTextarea>
                    <!--p:message for="planDescription" id="planDescriptionMessage" /-->

                    <!--h:outputLabel for="planSaveButton" value="" /-->
                    <p:commandButton id="planSaveButton"
                                     value="#{MESSAGE.PLAN_ADD_BUTTON}"
                                     icon="ui-icon-plus"
                                     actionListener="#{scheduleDoctorView.addPlan}"
                                     update="errorMessage growl"
                                     oncomplete="PF('schedule').update(); PF('addPlanDialog').hide();"
                                     styleClass="myButton"/>

                </h:panelGrid>

            </p:dialog>
        </h:form>

        <script type="text/javascript">
            PrimeFaces.locales['ru'] = {
                closeText: 'закрыть',
                prevText: 'назад',
                nextText: 'вперед',
                currentText: 'сегодня',
                monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
                    'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
                monthNamesShort: ['Янв', 'Фев', 'Март', 'Апр', 'Май', 'Июнь',
                    'Июль', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
                dayNames: ['Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота', 'Воскресенье'],
                dayNamesShort: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                dayNamesMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                weekHeader: 'Пн',
                firstDay: 1,
                isRTL: false,
                showMonthAfterYear: false,
                yearSuffix: '',
                month: 'Месяц',
                week: 'Неделя',
                day: 'День',
                allDayText: 'Весь день'
            };

            PrimeFaces.widget.Dialog.prototype.applyFocus = function () {
                var firstInput = this.jq.find(':not(:submit):not(:button):input:visible:enabled:first');
                if (!firstInput.hasClass('hasDatepicker')) {
                    firstInput.focus();
                }
            }
        </script>


    </ui:define>
</ui:composition>